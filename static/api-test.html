<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>API æµ‹è¯•å·¥å…·</title>
<style>
:root{--bg:#0f0f1a;--bg2:#1a1a2e;--text:#e8e8f0;--text2:#8888a0;--accent:#6366f1;--border:#2d2d4a;--success:#22c55e;--error:#ef4444}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;padding:40px 20px}
.container{max-width:900px;margin:0 auto}
h1{text-align:center;margin-bottom:30px;font-size:28px}
.card{background:var(--bg2);border-radius:16px;padding:24px;margin-bottom:20px}
.card h2{font-size:18px;margin-bottom:16px;display:flex;align-items:center;gap:10px}
.form-group{margin-bottom:16px}
.form-group label{display:block;font-size:13px;color:var(--text2);margin-bottom:8px}
.form-group input,.form-group textarea,.form-group select{width:100%;padding:12px;border:1px solid var(--border);border-radius:8px;background:var(--bg);color:var(--text);font-size:14px;font-family:monospace}
.form-group textarea{min-height:120px;resize:vertical}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.btn{padding:12px 24px;border:none;border-radius:8px;cursor:pointer;font-size:14px;font-weight:500;transition:all .15s}
.btn-primary{background:var(--accent);color:#fff}
.btn-primary:hover{opacity:0.9}
.btn-success{background:var(--success);color:#fff}
.btn-danger{background:var(--error);color:#fff}
.btn-group{display:flex;gap:12px;margin-top:20px}
.result{background:var(--bg);border-radius:8px;padding:16px;margin-top:16px;font-family:monospace;font-size:13px;white-space:pre-wrap;word-break:break-all;max-height:400px;overflow-y:auto}
.result.success{border-left:4px solid var(--success)}
.result.error{border-left:4px solid var(--error)}
.status{padding:8px 16px;border-radius:20px;font-size:13px;display:inline-flex;align-items:center;gap:8px}
.status.success{background:rgba(34,197,94,0.2);color:var(--success)}
.status.error{background:rgba(239,68,68,0.2);color:var(--error)}
.status.loading{background:rgba(99,102,241,0.2);color:var(--accent)}
.timer{font-size:14px;color:var(--accent);margin-left:auto}
.header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}
.presets{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px}
.preset{padding:6px 12px;background:var(--bg);border:1px solid var(--border);border-radius:6px;cursor:pointer;font-size:12px;color:var(--text2)}
.preset:hover{border-color:var(--accent);color:var(--accent)}
</style>
</head>
<body>
<div class="container">
<h1>ğŸ”§ API æµ‹è¯•å·¥å…·</h1>

<div class="card">
<h2>âš™ï¸ é…ç½®</h2>
<div class="form-group">
<label>API åœ°å€</label>
<input type="text" id="apiUrl" placeholder="https://api.example.com/v1">
</div>
<div class="form-group">
<label>API Key</label>
<div style="position:relative">
<input type="password" id="apiKey" placeholder="sk-xxxxxxxx" style="padding-right:50px">
<button type="button" onclick="toggleApiKey()" id="toggleKeyBtn" style="position:absolute;right:8px;top:50%;transform:translateY(-50%);background:none;border:none;color:var(--text2);cursor:pointer;font-size:16px;padding:4px 8px">ğŸ‘ï¸</button>
</div>
</div>
<div class="form-row">
<div class="form-group">
<label>æ¨¡å‹</label>
<input type="text" id="model" value="gpt-4o" placeholder="gpt-4o">
</div>
<div class="form-group">
<label>ç±»å‹</label>
<select id="apiType">
<option value="openai">OpenAI å…¼å®¹</option>
<option value="claude">Claude</option>
</select>
</div>
</div>
<div class="presets">
<span style="color:var(--text2);font-size:12px;margin-right:8px">é¢„è®¾:</span>
<button class="preset" onclick="setPreset('openai')">OpenAI</button>
<button class="preset" onclick="setPreset('deepseek')">DeepSeek</button>
<button class="preset" onclick="setPreset('zhipu')">æ™ºè°±AI</button>
<button class="preset" onclick="setPreset('moonshot')">Moonshot</button>
<button class="preset" onclick="setPreset('qwen')">é€šä¹‰åƒé—®</button>
</div>
</div>

<div class="card">
<h2>ğŸ’¬ æµ‹è¯•å¯¹è¯</h2>
<div class="form-group">
<label>æ¶ˆæ¯å†…å®¹</label>
<textarea id="message" placeholder="è¾“å…¥è¦å‘é€çš„æ¶ˆæ¯...">ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±</textarea>
</div>
<div class="btn-group">
<button class="btn btn-primary" onclick="testChat()">ğŸš€ å‘é€è¯·æ±‚</button>
<button class="btn btn-success" onclick="testModels()">ğŸ“‹ è·å–æ¨¡å‹åˆ—è¡¨</button>
<button class="btn" style="background:var(--bg);border:1px solid var(--border);color:var(--text)" onclick="testConnection()">ğŸ” æµ‹è¯•è¿æ¥</button>
</div>
</div>

<div class="card">
<div class="header">
<h2 style="margin:0">ğŸ“„ å“åº”ç»“æœ</h2>
<span id="status"></span>
<span id="timer" class="timer"></span>
</div>
<div id="result" class="result" style="display:none"></div>
</div>

<div class="card">
<h2>ğŸ“ è¯·æ±‚è¯¦æƒ…</h2>
<div id="requestInfo" class="result" style="color:var(--text2)">å‘é€è¯·æ±‚åæ˜¾ç¤ºè¯¦æƒ…...</div>
</div>
</div>

<script>
const presets = {
    openai: { url: 'https://api.openai.com/v1', model: 'gpt-4o' },
    deepseek: { url: 'https://api.deepseek.com/v1', model: 'deepseek-chat' },
    zhipu: { url: 'https://open.bigmodel.cn/api/paas/v4', model: 'glm-4' },
    moonshot: { url: 'https://api.moonshot.cn/v1', model: 'moonshot-v1-8k' },
    qwen: { url: 'https://dashscope.aliyuncs.com/compatible-mode/v1', model: 'qwen-turbo' }
};

function setPreset(name) {
    const p = presets[name];
    if (p) {
        document.getElementById('apiUrl').value = p.url;
        document.getElementById('model').value = p.model;
    }
}

function toggleApiKey() {
    const input = document.getElementById('apiKey');
    const btn = document.getElementById('toggleKeyBtn');
    if (input.type === 'password') {
        input.type = 'text';
        btn.textContent = 'ğŸ™ˆ';
    } else {
        input.type = 'password';
        btn.textContent = 'ğŸ‘ï¸';
    }
}

function showStatus(type, text) {
    const el = document.getElementById('status');
    el.className = 'status ' + type;
    el.innerHTML = text;
}

function showResult(data, isError) {
    const el = document.getElementById('result');
    el.style.display = 'block';
    el.className = 'result ' + (isError ? 'error' : 'success');
    el.textContent = typeof data === 'string' ? data : JSON.stringify(data, null, 2);
}

function showRequest(info) {
    document.getElementById('requestInfo').textContent = JSON.stringify(info, null, 2);
}

let startTime = 0;
let timerInterval = null;

function startTimer() {
    startTime = Date.now();
    timerInterval = setInterval(() => {
        document.getElementById('timer').textContent = ((Date.now() - startTime) / 1000).toFixed(1) + 's';
    }, 100);
}

function stopTimer() {
    if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
    }
}

// è‡ªåŠ¨è¡¥å…¨ API URL è·¯å¾„
function normalizeUrl(url) {
    url = url.replace(/\/+$/, ''); // ç§»é™¤æœ«å°¾æ–œæ 
    // å¦‚æœ URL ä¸ä»¥ /v1 æˆ– /v4 ç­‰ç‰ˆæœ¬è·¯å¾„ç»“å°¾ï¼Œè‡ªåŠ¨æ·»åŠ  /v1
    if (!/\/v\d+$/.test(url) && !/\/compatible-mode\/v\d+$/.test(url)) {
        url += '/v1';
    }
    return url;
}

async function testConnection() {
    let url = document.getElementById('apiUrl').value.trim();
    const key = document.getElementById('apiKey').value.trim();
    
    if (!url || !key) {
        alert('è¯·å¡«å†™ API åœ°å€å’Œ API Key');
        return;
    }
    
    url = normalizeUrl(url);
    
    showStatus('loading', 'â³ æµ‹è¯•ä¸­...');
    startTimer();
    
    const requestInfo = {
        method: 'GET',
        url: url + '/models',
        headers: { Authorization: 'Bearer ' + key.substring(0, 10) + '...' }
    };
    showRequest(requestInfo);
    
    try {
        const resp = await fetch(url + '/models', {
            headers: { 'Authorization': 'Bearer ' + key }
        });
        stopTimer();
        
        if (resp.ok) {
            showStatus('success', 'âœ… è¿æ¥æˆåŠŸ');
            const data = await resp.json();
            showResult(data, false);
        } else {
            showStatus('error', 'âŒ HTTP ' + resp.status);
            const text = await resp.text();
            showResult(text, true);
        }
    } catch (e) {
        stopTimer();
        showStatus('error', 'âŒ è¯·æ±‚å¤±è´¥');
        showResult(e.message, true);
    }
}

async function testModels() {
    await testConnection();
}

async function testChat() {
    let url = document.getElementById('apiUrl').value.trim();
    const key = document.getElementById('apiKey').value.trim();
    const model = document.getElementById('model').value.trim();
    const message = document.getElementById('message').value.trim();
    
    if (!url || !key || !model || !message) {
        alert('è¯·å¡«å†™æ‰€æœ‰å­—æ®µ');
        return;
    }
    
    url = normalizeUrl(url);
    
    showStatus('loading', 'â³ è¯·æ±‚ä¸­...');
    startTimer();
    
    const payload = {
        model: model,
        messages: [{ role: 'user', content: message }],
        stream: false
    };
    
    const requestInfo = {
        method: 'POST',
        url: url + '/chat/completions',
        headers: { 
            Authorization: 'Bearer ' + key.substring(0, 10) + '...',
            'Content-Type': 'application/json'
        },
        body: payload
    };
    showRequest(requestInfo);
    
    try {
        const resp = await fetch(url + '/chat/completions', {
            method: 'POST',
            headers: {
                'Authorization': 'Bearer ' + key,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(payload)
        });
        stopTimer();
        
        const data = await resp.json();
        
        if (resp.ok) {
            showStatus('success', 'âœ… æˆåŠŸ');
            showResult(data, false);
        } else {
            showStatus('error', 'âŒ HTTP ' + resp.status);
            showResult(data, true);
        }
    } catch (e) {
        stopTimer();
        showStatus('error', 'âŒ è¯·æ±‚å¤±è´¥');
        showResult(e.message, true);
    }
}
</script>
</body>
</html>
